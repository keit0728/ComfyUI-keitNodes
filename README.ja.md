# ComfyUI-keitNodes

**言語:** [English](README.md) | [日本語](README.ja.md)

keit による ComfyUI カスタムノード集です。

## 機能

### 🌍 M2M-100 Translator

Meta の M2M-100（Many-to-Many 100）モデルを搭載した多言語翻訳ノード。100以上の言語間での翻訳をサポートします。

**主な機能:**
- **自動言語検出**: "auto_detect" に設定すると、ソース言語を自動で検出
- **100以上の言語サポート**: アジア、ヨーロッパ、アフリカなど主要な世界言語をサポート
- **複数のモデルサイズ**: 用途に応じて418Mまたは1.2Bパラメータモデルを選択可能
- **GPU アクセラレーション**: CUDA が利用可能な場合は自動的に高速化
- **ビームサーチ**: 設定可能なビームサーチで翻訳品質を向上
- **メモリ効率**: 複数のノードインスタンス間でモデルを共有

**サポート言語（抜粋）:**
- アジア: 日本語 (ja), 中国語 (zh), 韓国語 (ko), タイ語 (th), ベトナム語 (vi), ヒンディー語 (hi) など
- ヨーロッパ: 英語 (en), フランス語 (fr), ドイツ語 (de), スペイン語 (es), ロシア語 (ru), イタリア語 (it) など
- アフリカ: アラビア語 (ar), スワヒリ語 (sw), アムハラ語 (am), ハウサ語 (ha) など
- その他多数...

### 🎯 Pixel Limit Resizer (16×)

アスペクト比を維持しながらピクセル数制限内で画像をリサイズし、16の倍数解像度に最適化するインテリジェントなノード。3D VAE の時空間圧縮との互換性を考慮して設計されています。

**主な機能:**
- **ピクセル数制限**: 指定されたピクセル数制限内で最適解像度を計算
- **アスペクト比維持**: 元画像のアスペクト比を可能な限り維持
- **16の倍数制約**: 幅と高さが16の倍数になるよう調整（3D VAE 互換性）
- **複数のアップスケール手法**: nearest-exact, bilinear, area, bicubic, lanczos 補間方法をサポート
- **詳細な出力情報**: リサイズ後の画像と解像度情報、アスペクト比データを提供

**技術仕様:**
- **デフォルト最大ピクセル数**: 589,824（1024×576相当）
- **最小解像度**: 16×16
- **最大解像度**: 2048×2048
- **3D VAE 最適化**: 時空間圧縮（256×圧縮）に対応

### 📺 WanVideo Optimal Resizer

WanVideoプラットフォームに最適化されたプリセット解像度変換ノード。入力画像のアスペクト比を分析し、定義済みプリセットの中から最も適した解像度を自動選択してリサイズします。

**主な機能:**
- **プリセット解像度**: 480pと720pの2つのプリセットをサポート
- **複数アスペクト比サポート**: 各プリセットで5種類のアスペクト比をサポート
  - 16:9 縦向き・横向き
  - 1:1 正方形
  - ランドスケープ（1.29:1 / 1.31:1）
  - ポートレート（1:1.29 / 1:1.31）
- **インテリジェント選択**: アスペクト比の類似度とピクセル数の差を考慮した2段階選択アルゴリズム
- **詳細な解析情報**: リサイズ前後の詳細な統計情報を出力

**プリセット解像度:**

**480pプリセット:**
- 480×832（16:9 縦向き）
- 832×480（16:9 横向き）
- 624×624（1:1 正方形）
- 704×544（1.29:1 ランドスケープ）
- 544×704（1:1.29 ポートレート）

**720pプリセット:**
- 720×1280（16:9 縦向き）
- 1280×720（16:9 横向き）
- 960×960（1:1 正方形）
- 1088×832（1.31:1 ランドスケープ）
- 832×1088（1:1.31 ポートレート）

**選択アルゴリズム:**
1. **アスペクト比優先**: 元画像に最も近いアスペクト比の候補を特定
2. **解像度最適化**: アスペクト比が最適な候補の中で、最もピクセル数が近いものを選択

### 🔍 WanVideo Resolution Finder

WanVideoプラットフォーム向けの最適解像度計算ノード。WanVideo Optimal Resizerと同じアルゴリズムを使用しますが、リサイズは行わず、最適な解像度の値のみを返します。

**主な機能:**
- **解像度計算のみ**: 実際のリサイズは行わず、最適な幅と高さの値を出力
- **同一アルゴリズム**: WanVideo Optimal Resizerと同じ選択ロジックを使用
- **プリセット対応**: 480pと720pの2つのプリセットから選択
- **軽量処理**: 画像処理を行わないため高速に動作

**使用例:**
- リサイズ前に最適な解像度を確認したい場合
- 他のノードで解像度情報を使用したい場合
- バッチ処理で統一した解像度を事前に決定したい場合

**出力:**
- width (INT): 最適な幅のピクセル値
- height (INT): 最適な高さのピクセル値

## インストール

### 前提条件
- ComfyUI がインストールされ、動作していること

### 方法1: ComfyUI Manager（推奨）
1. ComfyUI Manager を開く
2. "ComfyUI-keitNodes" を検索
3. インストールをクリック

### 方法2: 手動インストール
1. ComfyUI の custom_nodes ディレクトリにこのリポジトリをクローン:
```bash
cd ComfyUI/custom_nodes
git clone https://github.com/yourusername/ComfyUI-keitNodes.git
```

2. 必要な依存関係をインストール:
```bash
cd ComfyUI-keitNodes
pip install -r requirements.txt
```

3. ComfyUI を再起動 